{% extends "admin/admin_base.html" %}

{% set dashboard_title = "B·∫£ng ƒêi·ªÅu Khi·ªÉn Qu·∫£n Tr·ªã H·ªá Th·ªëng" %}
{% set dashboard_type = "system" %}
{% set enable_realtime = true %}
{% set cache_version = "20250616001" %}
{% set use_api = true %}

{% block dashboard_content %}
<!-- Flash Messages are handled by admin_base.html -->
<div class="modern-dashboard">
    <div class="container-fluid">
        <!-- Enhanced Dashboard Hero Section -->
        <div class="dashboard-hero">
            <div class="hero-content">
                <div class="hero-text">
                    <h1 class="hero-title">
                        <i class="fas fa-tachometer-alt"></i>
                        B·∫£ng ƒêi·ªÅu Khi·ªÉn Qu·∫£n Tr·ªã H·ªá Th·ªëng
                    </h1>
                    <p class="hero-subtitle">Gi√°m s√°t v√† qu·∫£n l√Ω to√†n b·ªô h·ªá th·ªëng Lab Manager</p>
                </div>
                <div class="hero-actions">
                    <button class="btn btn-outline-light" onclick="refreshDashboard()">
                        <i class="fas fa-sync-alt"></i> L√†m m·ªõi
                    </button>
                    <button class="btn btn-light" data-toggle="modal" data-target="#systemOperationModal">
                        <i class="fas fa-cogs"></i> C√†i ƒë·∫∑t
                    </button>
                </div>
            </div>
            <div class="hero-status">
                <div class="status-badge online">
                    <div class="status-indicator"></div>
                    <span>H·ªá th·ªëng ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng</span>
                </div>
                <div class="last-update">
                    C·∫≠p nh·∫≠t l√∫c: <span id="current-time"></span>
                </div>
            </div>
        </div>

        <!-- Key Metrics Overview -->
        <div class="metrics-section">
            <div class="row g-4">
                <div class="col-xl-3 col-lg-6">
                    <div class="metric-card-modern primary">
                        <div class="metric-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="metric-content">
                            <div class="metric-number" id="total-users">{{ stats.user_count or 0 }}</div>
                            <div class="metric-label">T·ªïng ng∆∞·ªùi d√πng</div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-6">
                    <div class="metric-card-modern success">
                        <div class="metric-icon">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <div class="metric-content">
                            <div class="metric-number" id="active-users">{{ stats.active_users or 0 }}</div>
                            <div class="metric-label">ƒêang ho·∫°t ƒë·ªông</div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-6">
                    <div class="metric-card-modern info">
                        <div class="metric-icon">
                            <i class="fas fa-flask"></i>
                        </div>
                        <div class="metric-content">
                            <div class="metric-number" id="total-labs">{{ stats.lab_session_count or 0 }}</div>
                            <div class="metric-label">Phi√™n Lab</div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-6">
                    <div class="metric-card-modern warning">
                        <div class="metric-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="metric-content">
                            <div class="metric-number" id="system-alerts">{{ (stats.critical_alerts or 0) + (stats.warning_alerts or 0) }}</div>
                            <div class="metric-label">C·∫£nh B√°o</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Dashboard Content -->
        <div class="dashboard-content">
            <div class="row g-4">
                <!-- System Performance Section - Modern Design -->
                <div class="col-xl-8 col-lg-12">
                    <div class="dashboard-card performance-card">
                        <div class="card-header">
                            <div class="header-content">
                                <h5 class="card-title">
                                    <i class="fas fa-chart-line"></i>
                                    Hi·ªáu Su·∫•t H·ªá Th·ªëng
                                </h5>
                                <p class="card-subtitle">Gi√°m s√°t t√†i nguy√™n v√† hi·ªáu su·∫•t real-time</p>
                            </div>
                            <div class="header-actions">
                                <div class="status-badge online">
                                    <i class="fas fa-circle"></i>
                                    Live
                                </div>
                                <button class="btn btn-sm btn-outline-primary" onclick="refreshPerformance()">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- Performance Chart -->
                            <div class="chart-container">
                                <canvas id="performanceChart" height="200"></canvas>
                            </div>
                            
                            <!-- Performance Metrics -->
                            <div class="performance-metrics">
                                <div class="metric-item">
                                    <div class="metric-icon cpu">
                                        <i class="fas fa-microchip"></i>
                                    </div>
                                    <div class="metric-details">
                                        <div class="metric-label">CPU</div>
                                        <div class="metric-value">60.7%</div>
                                        <div class="metric-bar">
                                            <div class="bar-fill" style="width: 60.7%"></div>
                                        </div>
                                        <div class="metric-status good">Normal</div>
                                    </div>
                                </div>
                                
                                <div class="metric-item">
                                    <div class="metric-icon memory">
                                        <i class="fas fa-memory"></i>
                                    </div>
                                    <div class="metric-details">
                                        <div class="metric-label">RAM</div>
                                        <div class="metric-value">78.9%</div>
                                        <div class="metric-bar">
                                            <div class="bar-fill warning" style="width: 78.9%"></div>
                                        </div>
                                        <div class="metric-status warning">High</div>
                                    </div>
                                </div>
                                
                                <div class="metric-item">
                                    <div class="metric-icon disk">
                                        <i class="fas fa-hdd"></i>
                                    </div>
                                    <div class="metric-details">
                                        <div class="metric-label">Disk</div>
                                        <div class="metric-value">53.9%</div>
                                        <div class="metric-bar">
                                            <div class="bar-fill" style="width: 53.9%"></div>
                                        </div>
                                        <div class="metric-status good">Normal</div>
                                    </div>
                                </div>
                                
                                <div class="metric-item">
                                    <div class="metric-icon network">
                                        <i class="fas fa-wifi"></i>
                                    </div>
                                    <div class="metric-details">
                                        <div class="metric-label">Network</div>
                                        <div class="metric-value">21.4%</div>
                                        <div class="metric-bar">
                                            <div class="bar-fill" style="width: 21.4%"></div>
                                        </div>
                                        <div class="metric-status good">Active</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- User Activity Section - Modern Design -->
                <div class="col-xl-4 col-lg-12">
                    <div class="dashboard-card activity-card">
                        <div class="card-header">
                            <div class="header-content">
                                <h5 class="card-title">
                                    <i class="fas fa-users"></i>
                                    Ho·∫°t ƒê·ªông Ng∆∞·ªùi D√πng
                                </h5>
                                <p class="card-subtitle">Th·ªëng k√™ truy c·∫≠p real-time</p>
                            </div>
                            <div class="header-actions">
                                <button class="btn btn-sm btn-outline-primary" onclick="refreshActivity()">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- Activity Chart -->
                            <div class="chart-container small">
                                <canvas id="userActivityChart" height="150"></canvas>
                            </div>
                            
                            <!-- Activity Stats -->
                            <div class="activity-stats">
                                <div class="stat-row">
                                    <div class="stat-icon online">
                                        <i class="fas fa-circle"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-label">Online hi·ªán t·∫°i</div>
                                        <div class="stat-value" id="online-users">{{ stats.active_users or 0 }}</div>
                                    </div>
                                    <div class="stat-trend up">Live</div>
                                </div>
                                
                                <div class="stat-row">
                                    <div class="stat-icon login">
                                        <i class="fas fa-sign-in-alt"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-label">ƒêƒÉng nh·∫≠p h√¥m nay</div>
                                        <div class="stat-value" id="daily-logins">{{ stats.daily_logins or 0 }}</div>
                                    </div>
                                    <div class="stat-trend up">+{{ ((stats.daily_logins or 0) / (stats.user_count or 1) * 100) | round(1) }}%</div>
                                </div>
                                
                                <div class="stat-row">
                                    <div class="stat-icon session">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-label">Phi√™n ho·∫°t ƒë·ªông</div>
                                        <div class="stat-value" id="active-sessions">{{ stats.active_sessions_today or 0 }}</div>
                                    </div>
                                    <div class="stat-trend up">H√¥m nay</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>



        <!-- System Operations Section -->
        <div class="operations-section">
            <div class="row g-4">
                <div class="col-12">
                    <div class="operations-card">
                        <div class="card-header">
                            <h5 class="card-title">
                                <i class="fas fa-tools"></i>
                                Thao T√°c H·ªá Th·ªëng
                            </h5>
                            <div class="warning-badge">
                                C·∫©n tr·ªçng
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <ul class="operation-list">
                                <li class="operation-item">
                                    <div class="operation-info">
                                        <div class="operation-icon backup">
                                            <i class="fas fa-download"></i>
                                        </div>
                                        <div class="operation-details">
                                            <h6>Sao l∆∞u d·ªØ li·ªáu</h6>
                                            <p>T·∫°o b·∫£n sao l∆∞u ƒë·∫ßy ƒë·ªß h·ªá th·ªëng v√† c∆° s·ªü d·ªØ li·ªáu</p>
                                        </div>
                                    </div>
                                    <div class="operation-actions">
                                        <button type="button" class="operation-btn btn-primary" disabled>
                                            <i class="fas fa-download"></i> Sao l∆∞u
                                        </button>
                                    </div>
                                </li>
                                
                                <li class="operation-item">
                                    <div class="operation-info">
                                        <div class="operation-icon reset">
                                            <i class="fas fa-database"></i>
                                        </div>
                                        <div class="operation-details">
                                            <h6>ƒê·∫∑t l·∫°i Database</h6>
                                            <p>ƒê·∫∑t l·∫°i c·∫•u tr√∫c v√† d·ªØ li·ªáu c∆° s·ªü d·ªØ li·ªáu v·ªÅ tr·∫°ng th√°i ban ƒë·∫ßu</p>
                                        </div>
                                    </div>
                                    <div class="operation-actions">
                                        <button class="operation-btn btn-danger" disabled>
                                            <i class="fas fa-redo"></i> ƒê·∫∑t l·∫°i DB
                                        </button>
                                    </div>
                                </li>
                                
                                <li class="operation-item">
                                    <div class="operation-info">
                                        <div class="operation-icon settings">
                                            <i class="fas fa-cog"></i>
                                        </div>
                                        <div class="operation-details">
                                            <h6>ƒê·∫∑t l·∫°i C√†i ƒë·∫∑t</h6>
                                            <p>Kh√¥i ph·ª•c c√°c c√†i ƒë·∫∑t h·ªá th·ªëng v·ªÅ gi√° tr·ªã m·∫∑c ƒë·ªãnh</p>
                                        </div>
                                    </div>
                                    <div class="operation-actions">
                                        <button class="operation-btn btn-warning" disabled>
                                            <i class="fas fa-sync"></i> Reset Settings
                                        </button>
                                    </div>
                                </li>
                                
                                <li class="operation-item">
                                    <div class="operation-info">
                                        <div class="operation-icon logs">
                                            <i class="fas fa-file-alt"></i>
                                        </div>
                                        <div class="operation-details">
                                            <h6>X√≥a nh·∫≠t k√Ω</h6>
                                            <p>X√≥a c√°c t·ªáp nh·∫≠t k√Ω c≈© ƒë·ªÉ gi·∫£i ph√≥ng kh√¥ng gian ƒëƒ©a</p>
                                        </div>
                                    </div>
                                    <div class="operation-actions">
                                        <button class="operation-btn btn-primary" data-toggle="modal" data-target="#clearLogsModal">
                                            <i class="fas fa-trash"></i> X√≥a logs
                                        </button>
                                    </div>
                                </li>
                                
                                <li class="operation-item">
                                    <div class="operation-info">
                                        <div class="operation-icon restart">
                                            <i class="fas fa-redo"></i>
                                        </div>
                                        <div class="operation-details">
                                            <h6>Kh·ªüi ƒë·ªông l·∫°i</h6>
                                            <p>Kh·ªüi ƒë·ªông l·∫°i ·ª©ng d·ª•ng ƒë·ªÉ √°p d·ª•ng c√°c thay ƒë·ªïi m·ªõi</p>
                                        </div>
                                    </div>
                                    <div class="operation-actions">
                                        <button type="button" class="operation-btn btn-secondary" disabled>
                                            <i class="fas fa-redo-alt"></i> Restart
                                        </button>
                                    </div>
                                </li>
                                
                                <li class="operation-item">
                                    <div class="operation-info">
                                        <div class="operation-icon reset">
                                            <i class="fas fa-exclamation-triangle"></i>
                                        </div>
                                        <div class="operation-details">
                                            <h6>Reset h·ªá th·ªëng</h6>
                                            <p>ƒê·∫∑t l·∫°i to√†n b·ªô h·ªá th·ªëng v·ªÅ tr·∫°ng th√°i ban ƒë·∫ßu (Nguy hi·ªÉm!)</p>
                                        </div>
                                    </div>
                                    <div class="operation-actions">
                                        <button class="operation-btn btn-danger">
                                            <i class="fas fa-exclamation-triangle"></i> Reset
                                        </button>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Recent Activity Section -->
        <div class="row">
            <div class="col-md-6">
                <div class="card system-metrics">
                    <div class="card-header">
                        <h5>
                            <i class="fas fa-clock text-info"></i> 
                            Ho·∫°t ƒê·ªông G·∫ßn ƒê√¢y
                        </h5>
                        <small class="text-muted">
                            <i class="fas fa-sync-alt"></i> C·∫≠p nh·∫≠t real-time
                        </small>
                    </div>
                    <div class="card-body">
                        <div class="activity-feed">
                            <div class="activity-item">
                                <div class="activity-icon bg-success">
                                    <i class="fas fa-user-plus text-white"></i>
                                </div>
                                <div class="activity-content">
                                    <h6 class="mb-1">Ng∆∞·ªùi d√πng m·ªõi ƒëƒÉng k√Ω</h6>
                                    <p class="mb-0 text-muted">
                                        <small>User ID: #12345</small>
                                    </p>
                                </div>
                                <div class="activity-time">
                                    <small class="text-muted">5 ph√∫t tr∆∞·ªõc</small>
                                </div>
                            </div>
                            
                            <div class="activity-item">
                                <div class="activity-icon bg-primary">
                                    <i class="fas fa-calendar-check text-white"></i>
                                </div>
                                <div class="activity-content">
                                    <h6 class="mb-1">Ca th·ª±c h√†nh m·ªõi ƒë∆∞·ª£c t·∫°o</h6>
                                    <p class="mb-0 text-muted">
                                        <small>Lab Session: Python Basics</small>
                                    </p>
                                </div>
                                <div class="activity-time">
                                    <small class="text-muted">15 ph√∫t tr∆∞·ªõc</small>
                                </div>
                            </div>
                            
                            <div class="activity-item">
                                <div class="activity-icon bg-warning">
                                    <i class="fas fa-sign-in-alt text-white"></i>
                                </div>
                                <div class="activity-content">
                                    <h6 class="mb-1">Admin ƒëƒÉng nh·∫≠p</h6>
                                    <p class="mb-0 text-muted">
                                        <small>IP: {{ request.remote_addr or '192.168.1.100' }}</small>
                                    </p>
                                </div>
                                <div class="activity-time">
                                    <small class="text-muted">30 ph√∫t tr∆∞·ªõc</small>
                                </div>
                            </div>
                            
                            <div class="activity-item">
                                <div class="activity-icon bg-info">
                                    <i class="fas fa-database text-white"></i>
                                </div>
                                <div class="activity-content">
                                    <h6 class="mb-1">Backup t·ª± ƒë·ªông</h6>
                                    <p class="mb-0 text-muted">
                                        <small>Size: 2.4 MB</small>
                                    </p>
                                </div>
                                <div class="activity-time">
                                    <small class="text-muted">1 gi·ªù tr∆∞·ªõc</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center mt-3">
                            <a href="{{ url_for('admin.activity_logs') }}" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-list"></i> Xem t·∫•t c·∫£ ho·∫°t ƒë·ªông
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card system-metrics mb-4">
                    <div class="card-header">
                        <h5>
                            <i class="fas fa-chart-pie text-success"></i> 
                            Th·ªëng K√™ H·ªá Th·ªëng
                        </h5>
                        <small class="text-muted">T·ªïng quan t√¨nh tr·∫°ng</small>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="systemStatsChart" height="180"></canvas>
                        </div>
                        
                        <div class="row mt-3">
                            <div class="col-6">
                                <div class="text-center">
                                    <h5 class="text-success mb-0">99.8%</h5>
                                    <small class="text-muted">Uptime</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-center">
                                    <h5 class="text-primary mb-0">45ms</h5>
                                    <small class="text-muted">Response Time</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats Card -->
                <div class="card system-metrics">
                    <div class="card-header">
                        <h5>
                            <i class="fas fa-tachometer-alt text-warning"></i> 
                            Th·ªëng K√™ Nhanh
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-4">
                                <div class="quick-stat-item">
                                    <i class="fas fa-users text-primary mb-2"></i>
                                    <h6 class="mb-0">{{ stats.user_count or 156 }}</h6>
                                    <small class="text-muted">Users</small>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="quick-stat-item">
                                    <i class="fas fa-calendar text-success mb-2"></i>
                                    <h6 class="mb-0">{{ stats.lab_session_count or 89 }}</h6>
                                    <small class="text-muted">Sessions</small>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="quick-stat-item">
                                    <i class="fas fa-chart-line text-info mb-2"></i>
                                    <h6 class="mb-0">{{ stats.activity_count or 1248 }}</h6>
                                    <small class="text-muted">Activities</small>
                                </div>
                            </div>
                        </div>
                        
                        <hr class="my-3">
                        
                        <div class="row text-center">
                            <div class="col-6">
                                <div class="quick-stat-item">
                                    <i class="fas fa-exclamation-triangle text-warning mb-2"></i>
                                    <h6 class="mb-0">{{ stats.warning_alerts or 3 }}</h6>
                                    <small class="text-muted">Warnings</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="quick-stat-item">
                                    <i class="fas fa-check-circle text-success mb-2"></i>
                                    <h6 class="mb-0">98%</h6>
                                    <small class="text-muted">Success Rate</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Database Health Section -->
                <div class="card db-status-card">
                    <div class="card-header">
                        <h5>
                            <i class="fas fa-database text-info"></i> 
                            T√¨nh Tr·∫°ng C∆° S·ªü D·ªØ Li·ªáu
                        </h5>
                        <small class="text-muted">Hi·ªáu su·∫•t v√† s·ª≠ d·ª•ng database</small>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-6">
                                <div class="db-stat-item">
                                    <div class="db-icon">
                                        <i class="fas fa-save text-primary"></i>
                                    </div>
                                    <div class="db-info">
                                        <h6 class="mb-1">Dung l∆∞·ª£ng</h6>
                                        <div class="progress mb-1" style="height: 8px;">
                                            <div class="progress-bar bg-primary" style="width: {{ stats.db_usage_percent or 65 }}%"></div>
                                        </div>
                                        <small class="text-muted">{{ stats.db_size or '5.2 MB' }} / 100 MB</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="db-stat-item">
                                    <div class="db-icon">
                                        <i class="fas fa-table text-success"></i>
                                    </div>
                                    <div class="db-info">
                                        <h6 class="mb-1">B·∫£ng ho·∫°t ƒë·ªông</h6>
                                        <h5 class="text-success mb-0">{{ 
                                            (stats.user_count > 0) + 
                                            (stats.lab_session_count > 0) + 
                                            (stats.activity_count > 0) + 2 
                                        }}</h5>
                                        <small class="text-muted">/ 8 b·∫£ng ch√≠nh</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <hr class="my-3">
                        
                        <div class="row text-center">
                            <div class="col-4">
                                <div class="db-metric">
                                    <i class="fas fa-bolt text-warning mb-1"></i>
                                    <h6 class="mb-0">{{ 
                                        ((stats.user_count or 0) + (stats.lab_session_count or 0) + (stats.activity_count or 0)) / 1000 * 100 | round(1) if 
                                        ((stats.user_count or 0) + (stats.lab_session_count or 0) + (stats.activity_count or 0)) > 0 else 45.2 
                                    }}ms</h6>
                                    <small class="text-muted">Truy v·∫•n TB</small>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="db-metric">
                                    <i class="fas fa-check-circle text-success mb-1"></i>
                                    <h6 class="mb-0">99.8%</h6>
                                    <small class="text-muted">Uptime DB</small>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="db-metric">
                                    <i class="fas fa-sync text-info mb-1"></i>
                                    <h6 class="mb-0">{{ 
                                        (stats.user_count or 0) + (stats.lab_session_count or 0) 
                                    }}</h6>
                                    <small class="text-muted">K·∫øt n·ªëi</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Enhanced Clear Logs Modal -->
<div class="modal fade" id="clearLogsModal" tabindex="-1" role="dialog" aria-labelledby="clearLogsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title" id="clearLogsModalLabel">
                    <i class="fas fa-exclamation-triangle"></i> X√°c nh·∫≠n x√≥a nh·∫≠t k√Ω
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-critical mb-3">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>C·∫¢NH B√ÅO NGHI√äM TR·ªåNG:</strong> H√†nh ƒë·ªông n√†y s·∫Ω x√≥a vƒ©nh vi·ªÖn t·∫•t c·∫£ nh·∫≠t k√Ω ho·∫°t ƒë·ªông kh·ªèi h·ªá th·ªëng.
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-12">
                        <h6><i class="fas fa-info-circle text-info"></i> Th√¥ng tin v·ªÅ thao t√°c:</h6>
                        <ul class="list-unstyled ml-3">
                            <li><i class="fas fa-check text-success"></i> T·∫•t c·∫£ l·ªãch s·ª≠ ho·∫°t ƒë·ªông s·∫Ω b·ªã x√≥a</li>
                            <li><i class="fas fa-check text-success"></i> Kh√¥ng th·ªÉ kh√¥i ph·ª•c sau khi x√≥a</li>
                            <li><i class="fas fa-check text-success"></i> H√†nh ƒë·ªông s·∫Ω ƒë∆∞·ª£c ghi nh·∫≠n m·ªõi</li>
                        </ul>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="confirmText">
                        <strong>ƒê·ªÉ x√°c nh·∫≠n, vui l√≤ng nh·∫≠p "XOA NHAT KY" v√†o √¥ b√™n d∆∞·ªõi:</strong>
                    </label>
                    <input type="text" class="form-control" id="confirmText" placeholder="Nh·∫≠p XOA NHAT KY ƒë·ªÉ x√°c nh·∫≠n">
                    <small class="form-text text-muted">Thao t√°c n√†y y√™u c·∫ßu x√°c nh·∫≠n b·∫±ng vƒÉn b·∫£n</small>
                </div>
            </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> H·ªßy b·ªè
                </button>
                <button type="button" class="btn btn-secondary" disabled>
                    <i class="fas fa-trash-alt"></i> X√≥a nh·∫≠t k√Ω (ƒêang ph√°t tri·ªÉn)
                </button>
            </div>
        </div>
    </div>
</div>

<!-- System Operations Confirmation Modal -->
<div class="modal fade" id="systemOperationModal" tabindex="-1" role="dialog" aria-labelledby="systemOperationModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="systemOperationModalLabel">
                    <i class="fas fa-exclamation-triangle"></i> X√°c nh·∫≠n thao t√°c h·ªá th·ªëng
                </h5>
                <button type="button" class="btn-close text-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-critical mb-4">
                    <i class="fas fa-radiation-alt"></i>
                    <strong>NGUY HI·ªÇM:</strong> B·∫°n ƒëang th·ª±c hi·ªán thao t√°c c√≥ th·ªÉ ·∫£nh h∆∞·ªüng nghi√™m tr·ªçng ƒë·∫øn h·ªá th·ªëng!
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <h6><i class="fas fa-shield-alt text-danger"></i> Bi·ªán ph√°p an to√†n:</h6>
                        <ul class="list-unstyled ml-3">
                            <li><i class="fas fa-check text-success"></i> ƒê√£ sao l∆∞u d·ªØ li·ªáu</li>
                            <li><i class="fas fa-check text-success"></i> Th√¥ng b√°o cho team</li>
                            <li><i class="fas fa-check text-success"></i> Ki·ªÉm tra maintenance window</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="fas fa-clock text-warning"></i> Th·ªùi gian d·ª± ki·∫øn:</h6>
                        <p class="ml-3">
                            <i class="fas fa-hourglass-half"></i> Downtime: <strong>5-15 ph√∫t</strong><br>
                            <i class="fas fa-sync"></i> Recovery: <strong>1-3 ph√∫t</strong>
                        </p>
                    </div>
                </div>
                
                <div class="form-group mt-3">
                    <label for="operationConfirmText">
                        <strong>Nh·∫≠p "XAC NHAN THAO TAC" ƒë·ªÉ ti·∫øp t·ª•c:</strong>
                    </label>
                    <input type="text" class="form-control" id="operationConfirmText" placeholder="Nh·∫≠p XAC NHAN THAO TAC">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> H·ªßy b·ªè
                </button>
                <button type="button" class="btn btn-danger" id="confirmOperationBtn" disabled>
                    <i class="fas fa-bolt"></i> Th·ª±c hi·ªán thao t√°c
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// Enhanced modal interactions
document.addEventListener('DOMContentLoaded', function() {
    // Clear logs modal validation
    const confirmText = document.getElementById('confirmText');
    const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
    
    if (confirmText && confirmDeleteBtn) {
        confirmText.addEventListener('input', function() {
            const isValid = this.value.trim().toUpperCase() === 'XOA NHAT KY';
            confirmDeleteBtn.disabled = !isValid;
            confirmDeleteBtn.classList.toggle('btn-danger', isValid);
            confirmDeleteBtn.classList.toggle('btn-secondary', !isValid);
        });
    }
    
    // System operation modal validation
    const operationConfirmText = document.getElementById('operationConfirmText');
    const confirmOperationBtn = document.getElementById('confirmOperationBtn');
    
    if (operationConfirmText && confirmOperationBtn) {
        operationConfirmText.addEventListener('input', function() {
            const isValid = this.value.trim().toUpperCase() === 'XAC NHAN THAO TAC';
            confirmOperationBtn.disabled = !isValid;
            confirmOperationBtn.classList.toggle('btn-danger', isValid);
            confirmOperationBtn.classList.toggle('btn-secondary', !isValid);
        });
    }
    
    // Enhanced button interactions for dangerous operations
    const dangerousButtons = document.querySelectorAll('a[href*="reset_"], a[href*="clear_"]');
    dangerousButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            const operation = this.textContent.trim();
            const url = this.href;
            
            // Show system operation modal
            document.getElementById('systemOperationModalLabel').innerHTML = 
                `<i class="fas fa-exclamation-triangle"></i> X√°c nh·∫≠n: ${operation}`;
            
            document.getElementById('confirmOperationBtn').onclick = function() {
                window.location.href = url;
            };
            
            $('#systemOperationModal').modal('show');
        });
    });
    
    // Update time display - fix null element issue
    function updateTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('vi-VN', {
            hour12: false,
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        });
        
        // Try both possible element IDs
        const currentTimeEl = document.getElementById('current-time');
        const lastUpdateEl = document.getElementById('last-update');
        
        if (currentTimeEl) {
            currentTimeEl.textContent = timeString;
        }
        if (lastUpdateEl) {
            lastUpdateEl.textContent = timeString;
        }
    }
    
    // Update time immediately and then every second
    updateTime();
    setInterval(updateTime, 1000);
    
    // Initialize real-time dashboard for admin manager - prevent multiple initialization
    if (typeof SystemDashboard !== 'undefined' && !window.systemDashboard) {
        console.log('‚úÖ SystemDashboard class found, initializing...');
        try {
            window.systemDashboard = new SystemDashboard({
                type: 'system',
                realTime: true,
                updateInterval: 5000
            });
            console.log('‚úÖ SystemDashboard instance created');
            
            systemDashboard.init();
            console.log('‚úÖ SystemDashboard initialized successfully');
        } catch (error) {
            console.error('‚ùå Error initializing SystemDashboard:', error);
            alert('L·ªói kh·ªüi t·∫°o dashboard: ' + error.message);
        }
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (window.systemDashboard) {
                window.systemDashboard.cleanup();
            }
        });
    } else if (window.systemDashboard) {
        console.log('‚ÑπÔ∏è System Dashboard already initialized, skipping...');
    } else {
        console.error('‚ùå SystemDashboard class not found! Check if system_dashboard.js is loaded correctly.');
        
        // Fallback: Load simple dashboard script
        console.log('üîÑ Loading simple dashboard fallback...');
        const script = document.createElement('script');
        script.src = '{{ url_for("static", filename="js/simple_dashboard.js") }}';
        script.onload = function() {
            console.log('‚úÖ Simple dashboard script loaded');
        };
        script.onerror = function() {
            console.error('‚ùå Failed to load simple dashboard script');
            alert('L·ªói: Kh√¥ng th·ªÉ t·∫£i dashboard script. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi m·∫°ng.');
        };
        document.head.appendChild(script);
    }
    
    // Test API directly to debug
    console.log('üß™ Testing API endpoint directly...');
    fetch('/api/v1/system/metrics-demo')
        .then(response => {
            console.log('üìä Direct API test:', response.status, response.statusText);
            return response.json();
        })
        .then(data => {
            console.log('‚úÖ Direct API data:', data);
            
            // Test Chart.js availability
            console.log('üìà Chart.js available:', typeof Chart !== 'undefined');
            console.log('üìà Chart.js version:', typeof Chart !== 'undefined' ? Chart.version : 'N/A');
            
            // Test canvas elements
            const performanceCanvas = document.getElementById('performanceChart');
            const activityCanvas = document.getElementById('userActivityChart');
            console.log('üé® Performance canvas found:', !!performanceCanvas);
            console.log('üé® Activity canvas found:', !!activityCanvas);
            
            // Try to update one metric manually for testing
            const cpuElement = document.querySelector('#cpu-value, .metric-value:first-child, [data-metric="cpu"] .metric-value');
            if (cpuElement) {
                cpuElement.textContent = data.system.cpu_usage + '%';
                console.log('‚úÖ Updated CPU value manually');
            } else {
                console.warn('‚ö†Ô∏è CPU element not found');
            }
        })
        .catch(error => {
            console.error('‚ùå Direct API test failed:', error);
            alert('API Test Error: ' + error.message);
        });
});
</script>
{% endblock %}